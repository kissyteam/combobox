modulex.add("combobox/multi-word",["combobox"],function(t,e,n){var o,r,i=t("combobox");o=function(t){function e(t,e){var n=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],o=null!==window.mozInnerScreenX,r=document.createElement("div");r.id="input-textarea-caret-position-mirror-div",document.body.appendChild(r);var i=r.style,a=window.getComputedStyle?getComputedStyle(t):t.currentStyle;i.whiteSpace="pre-wrap","INPUT"!==t.nodeName&&(i.wordWrap="break-word"),i.position="absolute",i.visibility="hidden";for(var l=0;l<n.length;l++){var s=n[l];i[s]=a[s]}o?(i.width=parseInt(a.width)-2+"px",t.scrollHeight>parseInt(a.height)&&(i.overflowY="scroll")):i.overflow="hidden",r.textContent=t.value.substring(0,e),"INPUT"===t.nodeName&&(r.textContent=r.textContent.replace(/\s/g,"Â "));var u=document.createElement("span");u.textContent=t.value.substring(e)||".",r.appendChild(u);var h={top:u.offsetTop+parseInt(a.borderTopWidth)+u.offsetHeight,left:u.offsetLeft+parseInt(a.borderLeftWidth)},p=t;do h.left+=p.offsetLeft,h.top+=p.offsetTop;while(p=p.offsetParent);return document.body.removeChild(r),h}return t=e}(),r=function(t){function e(t,e){return e&&-1!==t.indexOf(e)}function n(t){t.newVal&&t.target===this.get("menu")&&this.alignWithCursor()}function r(t){var n,o,r=t.get("input"),i=t.get("value"),s=[],u=[],h=t.get("literal"),p=t.get("separator"),d=t.get("separatorType"),g=!1,f=d!==a,c=r.prop("selectionStart"),v=-1;for(n=0;n<i.length;n++)o=i.charAt(n),h&&o===h&&(g=!g),g?u.push(o):(n===c&&(v=s.length),f&&l.test(o)?(u.length&&s.push(u.join("")),u=[],u.push(o)):e(p,o)?d===a?(u.push(o),u.length&&s.push(u.join("")),u=[]):(u.length&&s.push(u.join("")),u=[],u.push(o)):u.push(o));return u.length&&s.push(u.join("")),s.length||s.push(""),-1===v&&(d===a&&e(p,o)&&s.push(""),v=s.length-1),{tokens:s,cursorPosition:c,tokenIndex:v}}var a="suffix",l=/\s|\xa0/,s=o,u=i;return t=u.extend({syncUI:function(){var t,e=this;e.get("alignWithCursor")&&(t=e.get("menu"),t.setInternal("align",null),t.on("beforeVisibleChange",n,this))},getCurrentValue:function(){var t=this,n=r(t),o=n.tokens,i=n.tokenIndex,l=t.get("separator"),s=t.get("separatorType"),u=o[i],h=u.length-1;if(s!==a){if(!e(l,u.charAt(0)))return void 0;u=u.slice(1)}else s===a&&e(l,u.charAt(h))&&(u=u.slice(0,h));return u},setCurrentValue:function(t,n){var o,i,s=this,u=s.get("input"),h=r(s),p=h.tokens,d=Math.max(0,h.tokenIndex),g=s.get("separator"),f=s.get("separatorType"),c=p[d+1]||"",v=p[d];f!==a?(p[d]=v.charAt(0)+t,!t||c&&l.test(c.charAt(0))||(p[d]+=" ")):(p[d]=t,i=v.length-1,e(g,v.charAt(i))?p[d]+=v.charAt(i):1===g.length&&(p[d]+=g)),o=p.slice(0,d+1).join("").length,s.set("value",p.join(""),n),u.prop("selectionStart",o),u.prop("selectionEnd",o)},alignWithCursor:function(){var t=this,e=t.get("menu"),n=t.get("input"),o=r(t),i=s(n[0],o.tokens.slice(0,o.tokenIndex).join("").length+1);e.move(i.left,i.top)}},{ATTRS:{separator:{value:",;"},updateInputOnDownUp:{value:!1},separatorType:{value:a},literal:{value:'"'},alignWithCursor:{}},xclass:"multi-value-combobox"})}(),n.exports=r});