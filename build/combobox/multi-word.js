modulex.add("combobox/multi-word",["util","node","combobox"],function(t,e,o){var n,r,i=t("util"),a=t("node"),s=t("combobox");n=function(t){function e(t){var e=o;return e||(e=l(u)),"textarea"===String(t[0].type.toLowerCase())?e.css("width",t.css("width")):e.css("width",9999),s.each(p,function(o){e.css(o,t.css(o))}),o||e.insertBefore(t[0].ownerDocument.body.firstChild),o=e,e}var o,n,r,s=i,l=a,u='<div style="z-index:-9999;overflow:hidden;position: fixed;left:-9999px;top:-9999px;opacity:0;white-space:pre-wrap;word-wrap:break-word;"></div>',h="<span>x</span>",p=["paddingLeft","paddingTop","paddingBottom","paddingRight","marginLeft","marginTop","marginBottom","marginRight","borderLeftStyle","borderTopStyle","borderBottomStyle","borderRightStyle","borderLeftWidth","borderTopWidth","borderBottomWidth","borderRightWidth","line-height","outline","height","fontFamily","fontSize","fontWeight","fontVariant","fontStyle"];return r=function(){var t=document,e=l("<input>");e.css({width:1,position:"absolute",left:-9999,top:-9999}),e.val("123456789"),e.appendTo(t.body),e[0].focus(),n=e[0].scrollLeft>0,e.remove(),r=function(){}},n=!1,t=function(t){var o=l(t);t=o[0];var r,i,a,u,p,g,c=t.ownerDocument,d=l(c),f=t.scrollTop,m=t.scrollLeft;return c.selection?(i=c.selection.createRange(),{left:i.boundingLeft+m+d.scrollLeft(),top:i.boundingTop+f+i.boundingHeight+d.scrollTop()}):(r=o.offset(),n||"textarea"===t.type?(a=e(o),u=t.selectionStart,a.html(s.escapeHtml(t.value.substring(0,u-1))+h),p=r,a.offset(p),g=a.last(),p=g.offset(),p.top+=g.height(),u>0&&(p.left+=g.width()),p.top-=f,p.left-=m,p):(r.top+=t.offsetHeight,r))}}(),r=function(t){function e(t,e){return e&&-1!==t.indexOf(e)}function o(t){t.newVal&&t.target===this.get("menu")&&this.alignWithCursor()}function r(t){var o,n,r=t.get("input"),s=t.get("value"),l=[],u=[],h=t.get("literal"),p=t.get("separator"),g=t.get("separatorType"),c=!1,d=g!==i,f=r.prop("selectionStart"),m=-1;for(o=0;o<s.length;o++)n=s.charAt(o),h&&n===h&&(c=!c),c?u.push(n):(o===f&&(m=l.length),d&&a.test(n)?(u.length&&l.push(u.join("")),u=[],u.push(n)):e(p,n)?g===i?(u.push(n),u.length&&l.push(u.join("")),u=[]):(u.length&&l.push(u.join("")),u=[],u.push(n)):u.push(n));return u.length&&l.push(u.join("")),l.length||l.push(""),-1===m&&(g===i&&e(p,n)&&l.push(""),m=l.length-1),{tokens:l,cursorPosition:f,tokenIndex:m}}var i="suffix",a=/\s|\xa0/,l=n,u=s;return t=u.extend({syncUI:function(){var t,e=this;e.get("alignWithCursor")&&(t=e.get("menu"),t.setInternal("align",null),t.on("beforeVisibleChange",o,this))},getCurrentValue:function(){var t=this,o=r(t),n=o.tokens,a=o.tokenIndex,s=t.get("separator"),l=t.get("separatorType"),u=n[a],h=u.length-1;if(l!==i){if(!e(s,u.charAt(0)))return void 0;u=u.slice(1)}else l===i&&e(s,u.charAt(h))&&(u=u.slice(0,h));return u},setCurrentValue:function(t,o){var n,s,l=this,u=l.get("input"),h=r(l),p=h.tokens,g=Math.max(0,h.tokenIndex),c=l.get("separator"),d=l.get("separatorType"),f=p[g+1]||"",m=p[g];d!==i?(p[g]=m.charAt(0)+t,!t||f&&a.test(f.charAt(0))||(p[g]+=" ")):(p[g]=t,s=m.length-1,e(c,m.charAt(s))?p[g]+=m.charAt(s):1===c.length&&(p[g]+=c)),n=p.slice(0,g+1).join("").length,l.set("value",p.join(""),o),u.prop("selectionStart",n),u.prop("selectionEnd",n)},alignWithCursor:function(){var t,e=this,o=e.get("menu"),n=e.get("input");t=l(n),o.move(t.left,t.top)}},{ATTRS:{separator:{value:",;"},separatorType:{value:i},literal:{value:'"'},alignWithCursor:{}},xclass:"multi-value-combobox"})}(),o.exports=r});